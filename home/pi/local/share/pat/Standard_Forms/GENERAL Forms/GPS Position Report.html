<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Position Report</title>
<script>

function RWS(str){
var text2 = str.replace(/\s+$/,"");
return text2.trim();
}

</script>
<script>

function shortmonth(monthnum) {
var monthname;
shortmonths = ["JAN", "FEB", "MAR","APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"] ;
monthname = shortmonths [monthnum];s
return monthname; }
function SetDateTime(TType,TheFld, FocusFld) {
var txt;
var myprompt;
var d = new Date(),
thisyear = d.getFullYear();
thismonth= d.getMonth();
thisday = d.getDate();
var monname;
h = (d.getHours()<10?'0':'') + d.getHours()
m = (d.getMinutes()<10?'0':'') + d.getMinutes()
s = (d.getSeconds()<10?'0':'') + d.getSeconds();
var now = new Date();
var utch = now.getUTCHours();
if (utch < 10) { utch = "0"+utch};
var utcs = now.getUTCMinutes();
if (utcs < 10) { utcs = "0"+utcs};
var myUTCtime = utch+":"+utcs+"Z";
var utcstr = d.toUTCString();
var localt = d.toLocaleTimeString();
var isostr = d.toISOString();
monthname = shortmonth (thismonth);
thismonth = thismonth + 1;
switch (TType) {
case 'hms' :
myprompt = h + ':' + m + ':' + s;
var RightNow = prompt("Time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'hm' :
myprompt = h + ':' + m;
var RightNow = prompt("Time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'm-d-y': myprompt = thismonth+ '-' + thisday+ '-'+ thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'm/d/y': myprompt = thismonth+ '/' + thisday+ '/'+ thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'd mmm y': myprompt = thisday+ ' ' + monthname+ ' '+ thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'mmm-d-y': myprompt = monthname+'-'+thisday+ '-' + thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'localampm': var myprompt = localt;
var RightNow = prompt("Local time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'fulldate': var myprompt = thisyear+ '-'+thismonth+'-'+thisday;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'fulldatetime': var myprompt = thisyear+'-'+thismonth+ '-'+thisday+' '+h + ':' + m ;
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'afulldatetime': var myprompt = thisyear+'-'+thismonth+ '-'+thisday+' '+h + ':' + m ;
var RightNow = myprompt;
document.getElementById(TheFld).value = RightNow;
break;
case 'autodate': var RightNow = thisyear+'-'+thismonth+ '-'+thisday ;
//var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'autotime': var RightNow = h + ':' + m ;
//var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'iso': var myprompt = isostr;
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'utc': var myprompt = utcstr;
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'zulu': var myprompt = isostr;
myprompt = isostr.replace("T", " "); slen = myprompt.length;
myprompt = myprompt.substr(0, slen-5)+'Z';
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'UTChm': var myprompt = myUTCtime;
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
}
// if(FocusFld !== null && FocusFld !== '') {document.getElementById(FocusFld).focus()} --/
}; 
function Countthelines(f) { 
var text1 = f
var text2 = text1.replace(/\s+$/,"");
var split2 = text2.split("\n"); 
var mytotal = split2.length * 17;
if (mytotal < 150) {
    mytotal = 150;
}
var tstr = mytotal.toString();
 return tstr;
}

function newfix(f){
var ThisText = document.getElementById(f).value;
var makeit = Countthelines(ThisText);
document.getElementById(f).style.height = makeit+"px"; 
}

function Fixarea() {

newfix("Comments");
// newfix("reply");

AutoGrowTextArea(document.getElementById("Comments"));
// AutoGrowTextArea(document.getElementById("reply"));
}
function RWS(str){
var text2 = str.replace(/\s+$/,"");
aquote = '"';
var text2=text2.replace(/\“/gm, aquote); 
var text2=text2.replace(/\”/gm, aquote); 
var text2=text2.replace(/\’/gm, "'"); 
var text2=text2.replace(/\‘/gm, "'"); 

  return text2.trim();
}

</script>
<style type="text/css">
body, td, th {
font-family: Arial,Helvetica,sans-serif;
font-size: 12px;
font-weight: inherit;
}
.zentriert {
font-size: 12px;
font-weight: inherit;
}
input, select {
padding: 1px;
-moz-border-radius-topleft: 2px;
-moz-border-radius-topright: 2px;
-moz-border-radius-bottomright: 2px;
-moz-border-radius-bottomleft: 2px;
font-family: Arial,Helvetica,sans-serif;
font-size: 12px;
font-weight: inherit;
}
textarea {
padding: 1px;
-moz-border-radius-topleft: 2px;
-moz-border-radius-topright: 2px;
-moz-border-radius-bottomright: 2px;
-moz-border-radius-bottomleft: 2px;
font-family: Arial,Helvetica,sans-serif;
font-size: 12px;
font-weight: inherit;
}
.rechtsbuendig {
font-size: 12px;
font-weight: inherit;
}
.SubmitBtn {
font-size: 12px;
font-weight: inherit;
}
.version {
color: #666666;
position: relative;
left: 0px;
top: 3px;
font-size: 12px;
font-weight: inherit;
}
</style>
<script type="text/javascript">
function TimeNow(Timefld, FocusFld) {
var txt;
var d = new Date(),
thisyear = d.getFullYear();
thismonth= d.getMonth();
thismonth = thismonth+1;
thisday = d.getDate();
h = (d.getHours()<10?'0':'') + d.getHours()
m = (d.getMinutes()<10?'0':'') + d.getMinutes()
s = (d.getSeconds()<10?'0':'') + d.getSeconds();
var myprompt = thisyear+ '-'+thismonth+'-'+thisday+' '+h + ':' + m;
var RightNow = prompt("", myprompt);
document.getElementById(Timefld).value = RightNow;
}
</script>
<style>
/*
body {color:#000; background:#fff; font:100%/1.5 arial,sans-serif;}
h2 {margin-top:0}
*/
/* Styling applied to classes only */
/* Pop-up content shifted off-screen when not in view.
Still readable by screen-reader software.
When targeted it fills the browser window.
*/
.pop-up {
	position:absolute;
	top:0;
	left:-500em;
	visibility: hidden;
}
.pop-up:target {position:static; left:0;}
/* The pop-up itself */
.popBox {
	background:#ffffff;
	position:absolute;
	left:30%;
	right:30%;
	top:20%;
	bottom:25%;
	z-index:10;
	border:1px solid #3a3a3a;
/* CSS3 where available: rounded corners, drop-shadow, and fade in. */
border-radius:.25rem;
box-shadow:0 .5rem .5rem rgba(0,0,0,.5);
	opacity:0;
	transition: opacity 0.8s ease-out;
	visibility: hidden;
}
:target .popBox {position:fixed; opacity:1;}
/* Light box properties */
.lightbox {
display:none;
text-indent:-200em;
background-color:rgba(0,0,0,.4);
width:100%;
height:100%;
position:fixed;
top:0;
left:0;
bottom:0;
right:0;
z-index:5;
}
:target .lightbox {display:block;}
/* The pop-ups close link, moved via CSS to the top right of the pop-up */
.close:link,
.close:visited {
	position: absolute;
	top: -0.75em;
	right: -0.75em;
	display: block;
	width: 2em;
	height: 2em;
	line-height: 1.8;
	padding: 0;
	text-align: center;
	text-decoration: none;
	background-color: #000;
	border: 2px solid #fff;
	color: #fff;
	border-radius: 50%;
box-shadow: 0 0 .5rem .5rem rba(0,0,0,.5);
	visibility: hidden;
}
.close:before {content:"X";}
.close:hover,
.close:active,
.close:focus {
box-shadow: 0 0 .5rem .5rem rba(255,0,0,.5);
background-color: #c00;
color: #fff;
}
.close span {
text-indent: -200em;
display: block;
}
/* The pop-up content div will scroll if it has too much content */
.popScroll {
	position:absolute;
	top: 1rem;
	left: 1rem;
	right: 1rem;
	bottom: 1rem;
	overflow-y: auto;
*overflow-y: scroll;
	padding-right: 0.5em;
	visibility: hidden;
}
.popScroll h2 {margin-top:0}
.formtext1 {font-family: Arial, Helvetica, sans-serif;
font-size: 10pt;
font-weight: normal;
}
 input[type=button] {

  border: 1px solid #0f88f2;;
   border-radius:.25rem;
  
  font-size: 12px;
  padding: 2px 2px;
 background-color: white;
  text-decoration: none;
  margin: 2px 2px;
  cursor: pointer;
}
input[type=submit] {
 border: 1.5px solid green;
  border-radius:.25rem;
  background-color: white;
 
  padding: 2px 2px;
  font-size: 14px;
   cursor: pointer;
}
input[type=GPS] {
 border: 1.5px solid green;
  border-radius:.25rem;
  background-color: white;
 width:218px;
  padding: 2px 2px;
  font-size: 12px;
   cursor: pointer;
}
input[type=reset] {
 border: 1.5px solid red;
 border-radius:.25rem;
  background-color: white;
 
  padding: 2px 2px;
  font-size: 14px;
   cursor: pointer;
}
input[type=regular] {
 border: 1.5px solid #999999;
  border-radius:.25rem;
width:230px;
  background-color: white;
 
  padding: 2px 2px;
  font-size: 12px;
   cursor: pointer;
}
.close1 {content:"X";}
.style13 {font-size: 14px}
.style14 {font-size: 10px}
.style15 {color: #FF0000}
.style16 {
	color: #FF0000;
	font-weight: bold;
}


.alert {
  padding: 20px;
  background-color: #fcfcac;
  color: black;
}

.closebtn {
  margin-left: 15px;
  color: white;
  font-weight: bold;
  float: right;
  font-size: 22px;
  line-height: 20px;
  cursor: pointer;
  transition: 0.3s;
}

.closebtn:hover {
  color: black;
}
.style23 {font-size: 14px; font-weight: bold; }
.style25 {color: #007F00}
.style26 {color: #2A0000}
.style28 {
	font-size: 18px;
	font-weight: bold;
}
.style29 {
	font-size: 12px;
	color: #007F00;
}
.style32 {
	color: #FF0000;
	font-size: 14px;
	font-weight: bold;
}
.style33 {
	color: #007F00;
	font-size: 14px;
	font-weight: bold;
}
.style36 {
	font-style: italic;
	font-size: 14px;
	font-weight: bold;
}
.style38 {color: #339900}
.style39 {
	font-size: 12px;
	font-style: italic;
	color: #009900;
}
.style40 {color: #000000}
.style41 {font-size: 12px; font-style: italic; color: #000000; }
.style43 {
	color: #0000FF;
	font-size: 12px;
}
hr.new1 {
  border-top: 1px dashed red;
}


.style44 {
	color: #009933;
	font-style: italic;
}
</style>
<script>

function SetDateTime(TType,TheFld, FocusFld) {
var txt;
var myprompt;
var d = new Date(),
thisyear = d.getFullYear();
thismonth= d.getMonth();
thisday = d.getDate();
var monname;

h = (d.getHours()<10?'0':'') + d.getHours()
m = (d.getMinutes()<10?'0':'') + d.getMinutes()
s = (d.getSeconds()<10?'0':'') + d.getSeconds();
var now = new Date();
var utch = now.getUTCHours();
if (utch < 10) { utch = "0"+utch};
var utcs = now.getUTCMinutes();
if (utcs < 10) { utcs = "0"+utcs};
var myUTCtime = utch+":"+utcs+"Z";
var utcstr = d.toUTCString();
var localt = d.toLocaleTimeString();
var isostr = d.toISOString();
//monthname = shortmonth (thismonth);
thismonth = thismonth + 1;
switch (TType) {
case 'hms' :
myprompt = h + ':' + m + ':' + s;
var RightNow = prompt("Time:", myprompt);

document.getElementById(TheFld).value = RightNow;
break;
case 'hm' :
myprompt = h + ':' + m;
var RightNow = prompt("Time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'm-d-y': myprompt = thismonth+ '-' + thisday+ '-'+ thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;
case 'm/d/y': myprompt = thismonth+ '/' + thisday+ '/'+ thisyear;
var RightNow = prompt("Date:", myprompt);

document.getElementById(TheFld).value = RightNow;
break;
case 'd mmm y': myprompt = thisday+ ' ' + monthname+ ' '+ thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'mmm-d-y': myprompt = monthname+'-'+thisday+ '-' + thisyear;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'localampm': var myprompt = localt;
var RightNow = prompt("Local time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'fulldate': var myprompt = thisyear+ '-'+thismonth+'-'+thisday;
var RightNow = prompt("Date:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'fulldatetime': var myprompt = thisyear+'-'+thismonth+ '-'+thisday+' '+h + ':' + m ;
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'autodate': var RightNow = thisyear+'-'+thismonth+ '-'+thisday ;
//var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'autotime': var RightNow = h + ':' + m ;
//var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;

case 'zulu': var myprompt = isostr;
myprompt = isostr.replace("T", " "); slen = myprompt.length;
myprompt = myprompt.substr(0, slen-5)+'Z';
var RightNow = prompt("Date time:", myprompt);
document.getElementById(TheFld).value = RightNow;
break;


}

// if(FocusFld !== null && FocusFld !== '') {document.getElementById(FocusFld).focus()} --/

}; </script>
<script>
// Test auto collect

function AutoGrowTextArea(textField)
{
  if (textField.clientHeight < textField.scrollHeight)
  {
    textField.style.height = textField.scrollHeight + "px";
    if (textField.clientHeight < textField.scrollHeight)
    {
      textField.style.height = 
        (textField.scrollHeight * 2 - textField.clientHeight) + "px";
    }
  }
}

function saveTextAsFile(fileNameToSaveAs, textToWrite) {
//var mytitle = document.getElementById('Title').value; 
var textToWrite = document.getElementById('parseme').value; 
var fileNameToSaveAs ="Position Report " + DateforFile()+".txt";
fileNameToSaveAs = prompt("", fileNameToSaveAs);
if (fileNameToSaveAs==null) { return false;}
 document.getElementById('LastSave').value = fileNameToSaveAs;

	if (fileNameToSaveAs.value !== null) {store();
	RestoreTitle();}

  /* Saves a text string as a blob file*/  
  var ie = navigator.userAgent.match(/MSIE\s([\d.]+)/),
      ie11 = navigator.userAgent.match(/Trident\/7.0/) && navigator.userAgent.match(/rv:11/),
      ieEDGE = navigator.userAgent.match(/Edge/g),
      ieVer=(ie ? ie[1] : (ie11 ? 11 : (ieEDGE ? 12 : -1)));

  if (ie && ieVer<10) {
    console.log("No blobs on IE ver<10");
    return;
  }

  var textFileAsBlob = new Blob([textToWrite], {
    type: 'text/plain'
  });

  if (ieVer>-1) {
    window.navigator.msSaveBlob(textFileAsBlob, fileNameToSaveAs);


  } else {
    var downloadLink = document.createElement("a");
    downloadLink.download = fileNameToSaveAs;
    downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    downloadLink.onclick = function(e) { document.body.removeChild(e.target); };
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    downloadLink.click();

  }
 
}





function destroyClickedElement(event)
{
    document.body.removeChild(event.target);
	  alert(fileNameToSaveAs);
}

function loadFileAsText()
{

    var fileToLoad = document.getElementById("fileToLoad").files[0];
 
    var fileReader = new FileReader();
    fileReader.onload = function(fileLoadedEvent) 
    {
        var textFromFileLoaded = fileLoadedEvent.target.result;
        document.getElementById("inputTextToSave").value = textFromFileLoaded;
    };
    fileReader.readAsText(fileToLoad, "UTF-8");
}


function DateforFile(RightNow) {
var txt;
var d = new Date(),
thisyear = d.getFullYear();
thismonth= d.getMonth();
thismonth = thismonth+1;
if (thismonth < 10) { thismonth = "0" + thismonth}

thisday = d.getDate();
if (thisday < 10) { thisday = "0" + thisday}

h = (d.getHours()<10?'0':'') + d.getHours()
m = (d.getMinutes()<10?'0':'') + d.getMinutes()
var myprompt = thisyear+ '-'+thismonth+'-'+thisday+' '+h + '_' + m ;
return myprompt;
}

function isObject(arg) {
  return Object.prototype.toString.call(arg)==='[object Object]';
}

function formDataToObject(elForm) {
  if (!elForm instanceof Element) return;
  var fields = elForm.querySelectorAll('input, select, textarea'),
    o = {};
  for (var i=0, imax=fields.length; i<imax; ++i) {
    var field = fields[i],
      sKey = field.name || field.id;
    if (field.type==='button' || field.type==='image' || field.type==='submit' || !sKey) continue;
    switch (field.type) {
      case 'checkbox':
        o[sKey] = +field.checked;
        break;
      case 'radio':
        if (o[sKey]===undefined) o[sKey] = '';
        if (field.checked) o[sKey] = field.value;
        break;
      case 'select-multiple':
        var a = [];
        for (var j=0, jmax=field.options.length; j<jmax; ++j) {
          if (field.options[j].selected) a.push(field.options[j].value);
        }
        o[sKey] = a;
        break;
      default:
        o[sKey] = field.value;
    }
  }
 // alert('Form data:\n\n' + JSON.stringify(o, null, 2));
 document.getElementById('parseme').value = JSON.stringify(o, null, 2);
//  return o;
}

function populateForm(o) {

o =  JSON.parse(document.getElementById('parseme').value);
 //if (!isObject(o)) return;
if (!isObject(o)) return;
  for (var i in o) {
    var el = document.getElementById(i) || document.querySelector('[name=' + i + ']');
    if (el.type==='radio') el = document.querySelectorAll('[name=' + i + ']');
    switch (typeof o[i]) {
      case 'number':
        el.checked = o[i];
        break;
      case 'object':
        if (el.options && o[i] instanceof Array) {
          for (var j=0, jmax=el.options.length; j<jmax; ++j) {
            if (o[i].indexOf(el.options[j].value)>-1) el.options[j].selected = true;
          }
        }
        break;
      default:
        if (el instanceof NodeList) {
          for (var j=0, jmax=el.length; j<jmax; ++j) {
            if (el[j].value===o[i]) el[j].checked = true;
          }
        } else {
          el.value = o[i];
        }
    }
  }
    getit();
	AutoGrowTextArea(document.getElementById("Message"));

}
function store(){
 	var formatted= document.getElementById("LastSave");
     localStorage.setItem("LastPos", formatted.value);
    }

	function getit() {
	var storedValue = localStorage.getItem("LastPos");
	document.getElementById('LastSave').value = storedValue;
	RestoreTitle();
	}
	
	function RestoreTitle() {

var RightNow = document.getElementById('LastSave').value;

//document.getElementById('Title').value = RightNow;
document.getElementById('SubjectText').innerHTML = 'Last Saved:'+RightNow+'&nbsp;';
store();
}
function SaveData() {
	
			formDataToObject(document.getElementById('myform'))
			saveTextAsFile();
			 
			 // alert(fileNameToSaveAs);
			//saveTextAsFile();
			}

//-------
 function readBlob(opt_startByte, opt_stopByte) {
  
    var files = document.getElementById('files').files;
    if (!files.length) {
      alert('Please select a file!');
      return;
    }

    var file = files[0];
    var start = parseInt(opt_startByte) || 0;
    var stop = parseInt(opt_stopByte) || file.size - 1;

    var reader = new FileReader();

    // If we use onloadend, we need to check the readyState.
    reader.onloadend = function(evt) {
      if (evt.target.readyState == FileReader.DONE) { // DONE == 2
        document.getElementById('byte_content').textContent = evt.target.result;
        document.getElementById('byte_range').textContent = 
            ['Read bytes: ', start + 1, ' - ', stop + 1,
             ' of ', file.size, ' byte file'].join('');
      }
    };

    var blob = file.slice(start, stop + 1);
    reader.readAsBinaryString(blob);
  }
    	
  window.onload = function () { 
 
 //Check the support for the File API support 
 if (window.File && window.FileReader && window.FileList && window.Blob) {
    var fileSelected = document.getElementById('txtfiletoread');
	
    fileSelected.addEventListener('change', function (e) { 
         //Set the extension for the file 
         var fileExtension = /text.*/; 
         //Get the file object 
         var fileTobeRead = fileSelected.files[0];
        //Check of the extension match 
         if (fileTobeRead.type.match(fileExtension)) { 
             //Initialize the FileReader object to read the 2file 
			
             var fileReader = new FileReader(); 
             fileReader.onload = function (e) { 
                 var fileContents = document.getElementById('filecontents'); 
                
				document.getElementById('parseme').value =fileReader.result;
				populateForm(obj = document.getElementById('parseme').value);
					 } 
             fileReader.readAsText(fileTobeRead); 
         } 
         else { 
             alert("Please select text file"); 
         }
 
    }, false);
} 
 else { 
     alert("Files are not supported"); 
 } 
 getit();
  checkexternalGPS();
  alertBanner();
 }
 

// function setcolors() {
	
	
function isNumberKey(evt)  

{  
if(event.keyCode==13){return false;}
var charCode = (evt.which) ? evt.which : event.keyCode  

if (charCode > 32 && (charCode < 43 || charCode > 57))  

//if (charCode > 32 && (charCode < 40 ))  

return false;  

return true;  
  
}  

////////------- not functions ro do conversions -----------


function checkexternalGPS () {

var GPSstr= document.getElementById("GPS").value;
 var n = GPSstr.search("available");
//var O  = GPSstr.search("GPS");
 if (n >0){
 // disable button to copy
document.getElementById("GPS").disabled = true;
document.getElementById("CopyGPS").disabled = true;
document.getElementById('CopyGPS').value = 'No External GPS is connected' ;
 }
}

function fillfull()
{
var GPSstr= document.getElementById("GPS").value;
var Fullstring = GPSstr;
var Fullstring=Fullstring.replace(/-/gm, "\xB0");
//var Fullstring=Fullstring.replace(".","'");
//var Fullstring=Fullstring.replace(".","'");
var Fullstring=Fullstring.replace("N", "'N");
var Fullstring=Fullstring.replace("S","'S");
var Fullstring=Fullstring.replace("E", "'E");
var Fullstring=Fullstring.replace("W", "'W");
document.getElementById("full").value=Fullstring;
}
function copyGPS() {
var GPSstr= document.getElementById("myGPS").value;


if(GPSstr !== '{GPS}'){
var nameArr = GPSstr.split(" ");
var a =nameArr[0];
var b =nameArr[1];
} //64
var nameArr = GPSstr.split(" ");
var a =nameArr[0];
var b =nameArr[1];
fillfull();
document.getElementById("Lat").value=a;
document.getElementById("Lon").value=b;
var GPSstr= document.getElementById("GPS").value;
var Fullstring = GPSstr;
var Fullstring=Fullstring.replace(/-/gm, "\xB0");
var Fullstring=Fullstring.replace(".","'");
var Fullstring=Fullstring.replace(".","'");
var Fullstring=Fullstring.replace("N", '"N');
var Fullstring=Fullstring.replace("S", '"S');
var Fullstring=Fullstring.replace("E", '"E');
var Fullstring=Fullstring.replace("W", '"W');
//var e1 = parse_gps (Fullstring);
//alert(' 808 parse '+Fullstring);

//document.getElementById("full").value=Fullstring;
//backtodec (Fullstring);
var nameArr = Fullstring.split(" ");
var a =nameArr[0];
var b =nameArr[1];
//alert('1019 --------- '+b);
d=convertDMSToDD(a);
d = d+'';
//d=d.padEnd(17, '0');

d1 =convertDMSToDD(b);
d1 = d1+'';
//d1=d1.padEnd(15, '0')
//document.getElementById("Lat").value = d;
//document.getElementById("Lon").value = d1;
document.getElementById("MyDec").value = d+', '+d1;
document.getElementById("dd").value = d+', '+d1;
latLonToGridSquare(d,d1);
MGRSString(d,d1);//alert('870 '+d+' '+d1);

function convertDMSToDD (dms) {
t= "{"; var 
n = GPSstr.search(t);

//alert(dms);
//window.onerror = function(){
   //return true;
//}

     var parts = dms.split(/[^\d+(\,\d+)\d+(\.\d+)?\w]+/);
     var degrees = parseFloat(parts[0]);
     var minutes = parseFloat(parts[1]);
	 var seconds = parseFloat(parts[2].replace(',','.'));
     var direction = parts[3];

     var dd = degrees + Number((minutes  +'.'+ seconds )/60);
dd= dd.toFixed(4);
	     if (direction == 'S' || direction == 'W') {
       dd = dd * -1;
     } // Don't do anything for N or E
     return dd;
   }
}

function WarnUser(){
	var x= document.getElementById("SubmitWarn").value;
	var UserCall ="{Callsign}";
if (x == 'YES'){
alert('**IMPORTANT NOTICE**\nSelect From: "'+UserCall+'" on the Winlink message screen before you Post to Outbox.\nPosition Reports must always be sent from your base call sign. \nPosition reports sent from tactical addresses will not work.');
}
}
function alertBanner(){
	var mycall = "{callsign}";
 var thesender = "{MsgSender}";
 // var x = document.getElementById("myDIV");
var x = document.getElementById("myDIV")
x.style.display = "none";
if ((mycall !== thesender)){
    x.style.display = "block";
	 document.getElementById("SubmitWarn").value = "YES";
 }
}

function copytoClip(Whichfield,thetxt) {
  var copyText = document.getElementById(Whichfield);
  copyText.select();
  copyText.setSelectionRange(0, 99999)
  document.execCommand("copy");
  alert(thetxt+ copyText.value);
  return false;
}


function OffertoSave() {
	
	if (confirm("Do you want to save this position report before posting?\n press OK to SAVE the data before posting.")) {
 
  	SaveData();
   	return false;
	}
}
function convertthis(){

var nameArr=[];
var thestring= document.getElementById("dd").value;
document.getElementById("MyDec").value = thestring;
 var n = thestring.search(",");
 var n1= thestring.search(" ");
if (n>0){var nameArr = thestring.split(",");latLonToGridSquare(nameArr); MGRSString(nameArr); } 
else {if (n1>0){var nameArr = thestring.split(" ");} 

latLonToGridSquare(nameArr);//MGRSString(nameArr);


}
//alert(nameArr.length);

var a =nameArr[0];
a= (a);
var a =nameArr[0];
var b =nameArr[1];
//if (b ==NaN) {alert ('error ');}
var a1=(a);

var b1=(b);

//if (b<0) {var b=b *-1}; //alert(b);
var final = convertDMS (a,b);
final = document.getElementById("full").value
//alert('FINAL '+final);
var latlon = final.split(" ")
var lat1 = latlon[0];
var lat1= lat1.replace('°','-');
var lat1= lat1.replace("'",'');
//alert('862 lat1 '+latlon[0]);
document.getElementById("Lat").value = lat1;
var lon1 = latlon[1];
var lon1= lon1.replace('°','-');
var lon1= lon1.replace("'",'');
//alert('868 lon1 '+latlon[1]);
document.getElementById("Lon").value = lon1;
//alert(nameArr[0]);
//alert(nameArr[1]);
//var a= convert3(a,'Lat');
//var sign = ((a1> 0) ? "N" : "S");

}

function convert2(dd)
    { var txt='';
    	//var dd = document.getElementById("dd").value;
    	var sign="";
        // TODO - degrees should be normalized to the range [0,365]
    	//if( dd<0 ) { sign="-"; dd=-dd;}
        // first, compute the total number of seconds: degrees * 60 minutes/degree * 60 seconds/minute
        var totalSeconds = dd * 3600;
		//alert('888 '+totalSeconds);
    	var degrees = Math.floor(dd);
        totalSeconds -= degrees * 3600;
		
        // totalSeconds now represents the fractional degrees
    	var minutes = Math.floor(totalSeconds / 60);
        totalSeconds -= minutes * 60;
    	totalSeconds =totalSeconds.toFixed(0)
     	//txt+=" = "+sign+degrees+"\u00B0 "+minutes+"' "+totalSeconds+"\"";
			// txt=sign+degrees+"\u00B0"+minutes+"'"+totalSeconds+'"';
			//txt=degrees+"\u00B0"+minutes+"'"+totalSeconds+'"';
			txt=degrees+"-"+minutes+"."+totalSeconds;
     	return(txt);
    }
	function convertDMS( lat, lng ) {
 
        var convertLat = Math.abs(lat);
        var LatDeg = Math.floor(convertLat);
        var LatMin = (((convertLat - LatDeg) * 60));
		var LatMin =LatMin.toFixed(2)
		//alert(LatMin);
        var LatCardinal = ((lat > 0) ? "N" : "S");
         
        var convertLng = Math.abs(lng);
        var LngDeg = Math.floor(convertLng);
        var LngMin = (((convertLng - LngDeg) * 60));
				var LngMin =LngMin.toFixed(2)
        var LngCardinal = ((lng > 0) ? "E" : "W");
		
       txt= LatDeg +'°' + LatMin+ LatCardinal+' '+LngDeg  +'°' + LngMin+ LngCardinal;
		document.getElementById("full").value = txt;
        return LatDeg + LatMin+ LatCardinal + LatMin  + " " + LngDeg + LngMin + LngCardinal ;
		  return txt ;
}

latLonToGridSquare = function(param1,param2){
  var lat=-100.0;
  var lon=0.0;
  var adjLat,adjLon,GLat,GLon,nLat,nLon,gLat,gLon,rLat,rLon;
  var U = 'ABCDEFGHIJKLMNOPQRSTUVWX'
  var L = U.toLowerCase();
  // support Chris Veness 2002-2012 LatLon library and
  // other objects with lat/lon properties
  // properties could be getter functions, numbers, or strings
  function toNum(x){
    if (typeof(x) === 'number') return x;
    if (typeof(x) === 'string') return parseFloat(x);
    if (typeof(x) === 'function') return parseFloat(x());
    alert( "HamGridSquare -- toNum -- can not convert input: "+x);
  }
  if (typeof(param1)==='object'){
    if (param1.length === 2){
      lat = toNum(param1[0]);
      lon = toNum(param1[1]);
    } else if (('lat' in param1) && ('lon' in param1)){
      lat = toNum(param1.lat);
      lon = toNum(param1.lon);
    } else if (('latitude' in param1) && ('longitude' in param1)){
      lat = toNum(param1.latitude);
      lon = toNum(param1.longitude);
    } else {
      alert( "Please correct your coordinates -- "+param1);
    }
  } else {
    lat = toNum(param1);
    lon = toNum(param2);
  }
  if (isNaN(lat)) throw "lat is NaN";
  if (isNaN(lon)) throw "lon is NaN";
  if (Math.abs(lat) === 90.0) throw "grid squares invalid at N/S poles";
  if (Math.abs(lat) > 90) throw "invalid latitude: "+lat;
  if (Math.abs(lon) > 180) throw "invalid longitude: "+lon;
  adjLat = lat + 90;
  adjLon = lon + 180;
  GLat = U[Math.trunc(adjLat/10)];
  GLon = U[Math.trunc(adjLon/20)];
  nLat = ''+Math.trunc(adjLat % 10);
  nLon = ''+Math.trunc((adjLon/2) % 10);
  rLat = (adjLat - Math.trunc(adjLat)) * 60;
  rLon = (adjLon - 2*Math.trunc(adjLon/2)) *60;
  gLat = L[Math.trunc(rLat/2.5)];
  gLon = L[Math.trunc(rLon/5)];
  var mygrid = GLon+GLat+nLon+nLat+gLon+gLat;
  //alert( 'line 52 '+GLon+GLat+nLon+nLat+gLon+gLat);
  document.getElementById('Grid').value =mygrid;
}

function MGRSString (Lat,Long)

//function MGRSString (51.172,-1.779)
// 51.172,-1.779  38.556, -121.793
{ //var Lat = 38.556; var Long=-121.793; 
//var Lat1 = 38.556; var Long1=-121.793; 
var thestring= document.getElementById("MyDec").value;
 var res = thestring.split(",");
 var Lat = parseFloat(res[0]); var Long=parseFloat(res[1]); 
// var Lat = res[0];alert('Lat >'+Lat+'<');
// var Long = res[1]; alert('long >'+Long+'<');
 //Lat=38.556; Long=-121.793
if (Lat < -80) return 'Too far South' ; if (Lat > 84) return 'Too far North' ;
var c = 1 + Math.floor ((Long+180)/6);
var e = c*6 - 183 ;
var k = Lat*Math.PI/180; 
var l = Long*Math.PI/180;
var m = e*Math.PI/180;
var n = Math.cos (k);
var o = 0.006739496819936062*Math.pow (n,2);
var p = 40680631590769/(6356752.314*Math.sqrt(1 + o));
var q = Math.tan (k);
var r = q*q;
var s = (r*r*r) - Math.pow (q,6);
var t = l - m;
var u = 1.0 - r + o;
var v = 5.0 - r + 9*o + 4.0*(o*o);
var w = 5.0 - 18.0*r + (r*r) + 14.0*o - 58.0*r*o;
var x = 61.0 - 58.0*r + (r*r) + 270.0*o - 330.0*r*o;
var y = 61.0 - 479.0*r + 179.0*(r*r) - (r*r*r);
var z = 1385.0 - 3111.0*r + 543.0*(r*r) - (r*r*r);

var aa = p*n*t + (p/6.0*Math.pow (n,3)*u*Math.pow (t,3)) + (p/120.0*Math.pow (n,5)*w*Math.pow (t,5)) + (p/5040.0*Math.pow (n,7)*y*Math.pow (t,7));
var ab = 6367449.14570093*(k - (0.00251882794504*Math.sin (2*k)) + (0.00000264354112*Math.sin (4*k)) - (0.00000000345262*Math.sin (6*k)) + (0.000000000004892*Math.sin (8*k))) + (q/2.0*p*Math.pow (n,2)*Math.pow (t,2)) + (q/24.0*p*Math.pow (n,4)*v*Math.pow (t,4)) + (q/720.0*p*Math.pow (n,6)*x*Math.pow (t,6)) + (q/40320.0*p*Math.pow (n,8)*z*Math.pow (t,8));
aa = aa*0.9996 + 500000.0;

ab = ab*0.9996; if (ab < 0.0) ab += 10000000.0;
var ad = 'CDEFGHJKLMNPQRSTUVWXX'.charAt (Math.floor (Lat/8 + 10));
var ae = Math.floor (aa/100000);
var af = ['ABCDEFGH','JKLMNPQR','STUVWXYZ'][(c-1)%3].charAt (ae-1);
var ag = Math.floor (ab/100000)%20;
var ah = ['ABCDEFGHJKLMNPQRSTUV','FGHJKLMNPQRSTUVABCDE'][(c-1)%2].charAt (ag);
function pad (val) {if (val < 10) {val = '0000' + val} else if (val < 100) {val = '000' + val} else if (val < 1000) {val = '00' + val} else if (val < 10000) {val = '0' + val};return val};
aa = Math.floor (aa%100000); aa = pad (aa); 
ab = Math.floor (ab%100000); ab = pad (ab);
//var mrgs= c + ad + ' ' + af + ah + ' ' + aa + ' ' + ab;
var MRGS2=c + ad + ' ' + af + ah + ' ' + aa + ' ' + ab;
var mrgs= c + ad + af + ah  + aa + ab;
document.getElementById('WithSpaces').value =MRGS2;
document.getElementById('NoSpaces').value =mrgs;
document.getElementById('MGRS').value =mrgs;
//document.getElementById('MGRS2').value =MRGS2;
};

function Flip() {  
var withspace = document.getElementById('WithSpaces').value;
var nospace = document.getElementById('NoSpaces').value;

//document.getElementById('MGRS').value =mrgs;
   var Checked = document.getElementById("Format").checked;
   if (Checked) { document.getElementById('MGRS').value =withspace;}  else{document.getElementById('MGRS').value =nospace;}
   
}  

</script>
<title>Post Posistion Report</title></head>

<body>
<form  style="font-family: Arial;" pbzloc="3" onsubmit="WarnUser(); OffertoSave(); return confirm('To complete your form submission, click OK and close the open browser window. You will return to the new message window so you can post your message to the outbox');" method="post" id="myform" enctype="multipart/form-data" action="http://{FormServer}:{FormPort}">



. <td width="0%"></p>

</div>

<!-- The close pop-up link correctly positioned at the end of the content block -->

<table style="width: 1045px;" align="center" border="0">
<tbody>
<tr>
<td >
<table width="892" border="1" cellpadding="4" cellspacing="0" bordercolor="#999999" style="font-size: 14px; width: 900px; ">
<tbody>
<tr>
<td width="880" valign="top" style="text-align: center; vertical-align: top;">

 <div class="style9" id="myDIV" style.display = "none";>
<div class="alert" >
  <div align="left">
    <p align="center" class="style23">**NOTICE** </p>
    <p align="center" class="style23"> Position Reports can only be sent using a base call sign.</p>
    <p align="center" class="style23">            <span class="style15">You are about to SUBMIT with a tactical address: [{MsgSender}], and it will not be accepted by the CMS.</span> </p>
    <p align="center"><span class="style33">Close form and restart under your base call OR you may go ahead and complete the form, then follow instructions below;</span></p>
    <p align="center" class="style36">  Submit when done, select your base call [{CallSign}] using the From: menu in the  message window, now Post to the Outbox. </p>
    <p align="center" class="style32"><span class="style23"><span class="style26">In a few minutes reconnect to the CMS and you will receive a status message on your position, if NO status report then you used a tactical address by error.</span><br />
    </span></p>
    </div>
  </div>
</div>
<p><span class="style28">GPS Decimal Position Report for Winlink - Decimal Converter</span></p>
  <table width="100%"  border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td><div align="center"><b><span style="font-size: 12px;">
          <input name="SubmitWarn" type="hidden" id="SubmitWarn" value="NO" />
          <small>
          <input name="LastSave" type="hidden" id="LastSave"  />
          </small></span></b>
            <input name="loadbtn" type="button" id="loadbtn" onClick="document.getElementById('txtfiletoread').click();" style="border: 1.5px solid blue;" value=" Load Position Data" />        
            <br />
            <span  id="SubjectText">Winlink </span>            <input type="file" id="txtfiletoread" accept=".txt"  style="display: none;"/>
        </div>
        <div align="right"><span style="font-size: 12px;"> 
              <textarea name="parseme" cols="60" id="parseme" style="display: none;"></textarea> 
        </span></div></td>
      </tr>
  </table>
  </td>
</tr>
<tr>
<td valign="top"  style="vertical-align: top; text-align: center;"><span style="font-size: 14px;"> <pbzloc ="1" style="font-weight: normal;"></pbzloc></span>
<div align="left"><span style="font-size: 14px;"><pbzloc ="1" style="font-weight: normal;"></pbzloc></span>
  <table width="100%"   border="1" cellpadding="5" cellspacing="0" bordercolor="#CCCCCC">
    <tr>
      <td width="68%"><p>Date/Time &nbsp;&nbsp; &nbsp;
          <input name="thetime" id="thetime"  value="{UDateTime}" size="24" maxlength="23" placeholder="Click to Add Date/Time" onclick="SetDateTime('zulu',this.id)"/>
Click for current UTC Time
<input name="Lat" type="hidden" id="Lat" required />
<input name="Lon" type="hidden" id="Lon" onchange="convertDMS()" required">
<input name="Speed" type="hidden" id="Speed" value="{Speed}" size="20" maxlength="19" />
<input name="Course" type="hidden" id="Course" value="{course}" size="20" maxlength="19" />
      </p>
        <p>
            <input name="Title" type="hidden" id="Title" />
            <strong>Manually Enter your Decimal Degrees:&nbsp;</strong>
            <input name="dd" type="text" id="dd" onChange="convertthis() " onKeyPress="return isNumberKey(event)"   size="30" maxlength="30" placeholder="EXAMPLE: 38.5567, -121.7932">
            <span class="style14"><span class="style29">&nbsp;</span><span class="style39">Click any where to use</span><br>
            </span><span class="style15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="style14"><span class="style41">(If no connected GPS)</span> </span> <span class="style40">&nbsp;</span>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;Example: 38.5567<span class="style13"><strong>, </strong></span>-121.7932&nbsp;</em></span>  <span class="style15"><em>(note the comma)</em></span></p>
        <p>Comment: <span class="style38">Limited to 148 characters</span><br />
          <textarea  maxlength="148placeholder="insert your message" cols="100" rows="2" name="Message" id="Message"onkeypress="if(event.keyCode==13){return false;}"  ></textarea>
          <br />
</p>
        <p><strong>HINT</strong>: You will be prompted to save your Position Data BEFORE you<span class="style25"> Submit</span>. Save the data if you want to DELETE the sent position later. To do so, just use Load Position Data and change the Comment box to <span class="style16">DELETE</span><span class="style15"> <span class="style26">in all caps.</span></span> <span class="style15"><span class="style26">Now <span class="style25">Submit</span> this new report.</span></span> It will be deleted from all Winlink System lists and maps, but not APRS FI.
            <input name="WithSpaces" type="hidden" id="WithSpaces" />
            <input name="NoSpaces" type="hidden" id="NoSpaces" />
        </p></td>
      <td width="32%" valign="top" bgcolor="#f8f8ff"><p><span class="style13">External  data if GPS is connected:
      </span>        
          <input name="GPS" type="text" id="GPS" onKeyPress="return isNumberKey(event)" value="{GPS}" size="25">
      </p>
        <p>      
              <input name="CopyGPS" type="GPS" id="CopyGPS" onClick="copyGPS();" value=" Click to Use connected GPS LAT LON " />
              </p>
        <p>          <span class="style44">Your attached GPS device needs to be configured and  working in Winlink Express.</span><br />
        </p></td>
    </tr>
    <tr>
      <td colspan="2" valign="top">        <table width="100%"  border="1" cellspacing="0" cellpadding="10">
          <caption>
          <span class="style43"> Copy/Paste Current Coordinates converted for use with other mapping programs: </span>
          </caption>
          <tr bgcolor="#ffffe6">
            <td width="51%">Position in Decimal Degrees:<br />
              <input name="MyDec" type="text" id="MyDec" size="24" />
&nbsp;              <input name="CopyGPS" type="button" id="copymydec" onclick="copytoClip('MyDec','Copied coordinates: ');" value=" Copy to Clipboard " /></td>
            <td width="49%">Position in Degrees and Decimal Minutes<br />
              <input name="full" type="text" id="full" size="24" />
&nbsp;              <input name="CopyGPS" type="button" id="CopyGPS" onclick="copytoClip('full','Copied coordinates: ');" value=" Copy to Clipboard " /></td>
          </tr>
          <tr valign="top" bgcolor="#ffffe6">
            <td>Position Grid Square<br />
              <input name="Grid" type="text" id="Grid" size="24" />
&nbsp;              <input name="CopyGrid" type="button" id="copyGrid" onclick="copytoClip('Grid','Copied Grid Square: ');" value=" Copy to Clipboard " /></td>
            <td nowrap="nowrap">Position NATO/MGRS (Military Grid Reference System) <br />
                  <input name="MGRS" type="text" id="MGRS" size="24" />
                  &nbsp;
<input name="CopyGridMGRS" type="button" id="copyMGRS" onclick="copytoClip('MGRS','Copied MGRS: ');" value=" Copy to Clipboard " />
&nbsp;
 
<input name="Format" type="checkbox" id="Format" value="soaceit" onclick="Flip();"/>
&nbsp;Format with  spaces</td>
          </tr>
        </table>        
       
      </td>
      </tr>
  </table>
  <p align="center" class="style15"><em>THE WINLINK CMS DOES NOT ACCEPT  A TACTICAL ADDRESS, ONLY BASE CALLS.</em> <em>- APRS FI KEEPS POSITION REPORTS &amp; COMMENTS FOR 2 YEARS. </em></td>
</tr>
<tr>
<td valign="top" style="height: 35px; text-align: justify; vertical-align: top;" > <span style="font-family: Calibri;">
  </span>
  <table width="100%"  border="0" cellpadding="0" cellspacing="0" bordercolor="#FFFFFF">
    <tr>
      <td width="39%"><span style="font-family: Calibri;">
      </span>&nbsp;&nbsp;<span ><span><span style="font-size: 12px;"></span></span></span>&nbsp;
          <input style="height: 28px; width: 52px; " title="After submitting, close browser, then address message for posting" class="SubmitBtn" enctype="multipart/form-data" id="Submit" method="Post" name="Submit" value="Submit" type="submit" />
&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;</span>
        <input class="BtnFormat2" value="Reset Form " name="ResetForm" style="color: rgb(204, 0, 0);" type="reset" />
        <span style="color: rgb(128, 0, 0);"> &nbsp; &nbsp;<span style="color: black;"> </span><span style="color: black;">&nbsp;&nbsp;</span></span></td>
      <td width="61%" nowrap="nowrap">&nbsp;<span style="font-size: 12px;">Form Concept from LAX ARES CA 
&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;</span>&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;</span>&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;</span>&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;
<input name="myGPS" type="hidden" id="myGPS" onkeypress="return isNumberKey(event)" value="{GPS}" size="25" />
</span>&nbsp;<span style="color: rgb(128, 0, 0);"> &nbsp;</span>&nbsp;<span style="color: rgb(128, 0, 0);"> </span>Current Winlink Sender:
          <input name="UserCall" type="text" id="UserCall" value="{MsgSender}" size="15" maxlength="14" readonly>
      </span> Ver 7.2</td>
    </tr>
  </table>
  </td>
</tr>
</tbody>
</table>
<br />
&nbsp;</td>
</tr>
</tbody>
</table>
</form>
</body></html>